@model EventDTO
@{
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}
<form asp-controller="Event" asp-action="CreateCleanupEvent" method="post" enctype="multipart/form-data">
    <section class="content-main">
        <div class="row">
            <div class="col-12">
                <div class="content-header mb-3 text-center">
                    <h2 class="content-title">Tạo sự kiện mới</h2>
                </div>
            </div>
            <input asp-for="CreatedAt" type="hidden" id="CreatedAt" />

            <!-- Cột trái -->
            <div class="col-lg-8">
                <div class="card shadow-sm mb-4">
                    <div class="card-header text-white" style="background-color: #3BB77E;">
                        <h5 class="mb-0">Thông tin sự kiện</h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label asp-for="Title" class="form-label fw-bold">Tiêu đề</label>
                                <input asp-for="Title" class="form-control" required />
                                <span asp-validation-for="Title" class="text-danger"></span>
                            </div>

                            <div class="col-md-6">
                                <label asp-for="MaxParticipants" class="form-label fw-bold">Số lượng tham gia</label>
                                <input asp-for="MaxParticipants" class="form-control" type="number" min="1" required />
                                <span asp-validation-for="MaxParticipants" class="text-danger"></span>
                            </div>

                            <div class="col-md-6">
                                <label asp-for="StartDate" class="form-label fw-bold">Ngày bắt đầu</label>
                                <input asp-for="StartDate" type="datetime-local" class="form-control" id="StartDate" required />
                                <div id="startDateError" class="text-danger mt-1"></div>
                                <span asp-validation-for="StartDate" class="text-danger"></span>
                            </div>

                            <div class="col-md-6">
                                <label asp-for="EndDate" class="form-label fw-bold">Ngày kết thúc</label>
                                <input asp-for="EndDate" type="datetime-local" class="form-control" />
                                <span asp-validation-for="EndDate" class="text-danger"></span>
                            </div>

                            <div class="col-md-12">
                                <label asp-for="Address" class="form-label fw-bold">Địa chỉ</label>
                                <input asp-for="Address" class="form-control" required />
                                <span asp-validation-for="Address" class="text-danger"></span>
                            </div>

                            <div class="col-md-12">
                                <label asp-for="PointsAward" class="form-label fw-bold">Điểm thưởng</label>
                                <input asp-for="PointsAward" class="form-control" type="number" min="0" required />
                                <span asp-validation-for="PointsAward" class="text-danger"></span>
                            </div>

                            <div class="col-md-12">
                                <label asp-for="Description" class="form-label fw-bold">Mô tả</label>
                                <textarea asp-for="Description" class="form-control" rows="4" required></textarea>
                                <span asp-validation-for="Description" class="text-danger"></span>
                            </div>

                            <div class="col-md-12">
                                <label class="form-label fw-bold">Ảnh sự kiện</label>
                                <input type="file" name="ImageFile" accept="image/*" class="form-control" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cột phải -->
            <div class="col-lg-4">
                <div class="card shadow-sm mb-4">
                    <div class="card-body text-center">
                        <h5 class="mb-3">Thao tác</h5>
                        <button type="submit" class="btn btn-success w-100 mb-2">Tạo mới</button>
                        <a asp-controller="Event" asp-action="GetAllEvent" class="btn btn-outline-secondary w-100">
                            ← Quay lại danh sách
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>
</form>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const startInput = document.getElementById("StartDate");
            const endInput = document.getElementById("EndDate");

            const startErrorDiv = document.getElementById("startDateError");
            const endErrorDiv = document.getElementById("endDateError");

            function isFuture(date) {
                const now = new Date();
                return date.getTime() > now.getTime();
            }

            function validateStartDate() {
                const startDate = new Date(startInput.value);
                if (!isFuture(startDate)) {
                    startErrorDiv.textContent = "Ngày bắt đầu phải là ngày trong tương lai.";
                    startInput.value = "";
                    return false;
                } else {
                    startErrorDiv.textContent = "";
                    return true;
                }
            }

            function validateEndDate() {
                const startDate = new Date(startInput.value);
                const endDate = new Date(endInput.value);

                endErrorDiv.textContent = "";

                if (!isFuture(endDate)) {
                    endErrorDiv.textContent = "Ngày kết thúc phải là ngày trong tương lai.";
                    endInput.value = "";
                    return false;
                }

                if (startInput.value && endDate.getTime() - startDate.getTime() < 3600000) {
                    endErrorDiv.textContent = "Ngày kết thúc phải trễ hơn ngày bắt đầu ít nhất 1 giờ.";
                    endInput.value = "";
                    return false;
                }

                return true;
            }

            startInput.addEventListener("change", function () {
                validateStartDate();
                if (endInput.value) {
                    validateEndDate(); // revalidate end date in case it's now invalid
                }
            });

            endInput.addEventListener("change", function () {
                validateEndDate();
            });
        });
    </script>
}
