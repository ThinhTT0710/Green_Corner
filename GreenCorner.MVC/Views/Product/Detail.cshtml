@model ProductDetailViewModel
@{
    ViewData["Title"] = "Chi tiết sản phẩm";
    Layout = "_LayoutCart";

    bool isFallback = !(Model.Top3OpenEvents?.Any(e => e.Status == "Open") ?? false);
    string sectionTitleEvent = isFallback ? "Một số sự kiện gần đây" : "Sự kiện đang diễn ra";
}﻿
<div class="container mb-30">
    <div class="row">
        <div class="col-xl-10 col-lg-12 m-auto">
            <div class="product-detail accordion-detail">
                <div class="row mb-50 mt-30">
                    <div class="col-md-6 col-sm-12 col-xs-12 mb-md-0 mb-sm-5">
                        <div class="detail-gallery">
                            <span class="zoom-icon"><i class="fi-rs-search"></i></span>
                            <!-- MAIN SLIDES -->

                            <div class="product-image-slider">
                                @{
                                    var listImages = Model.Product.ImageUrl.Split('&');
                                    int index = 1;

                                    foreach (var image in listImages)
                                    {
                                        <figure class="border-radius-10">
                                            <img src="@image" alt="product-@index" />
                                        </figure>
                                    }
                                    index++;
                                }
                            </div>


                            <!-- THUMBNAILS -->
                            <div class="slider-nav-thumbnails">
                                @{
                                    int indexx = 1;
                                    foreach (var image in listImages)
                                    {
                                        <div><img src="@image" alt="product image" /></div>
                                        indexx++;
                                    }
                                }
                            </div>

                        </div>
                        <!-- End Gallery -->
                    </div>
                    @{
                        int price = (int)Model.Product.Price;
                        int priceDiscount = price - (Model.Product.Discount.HasValue ? (price * Model.Product.Discount.Value / 100) : 0);
                    }
                    <div class="col-md-6 col-sm-12 col-xs-12">
                        <div class="detail-info pr-30 pl-30">
                            <span class="stock-status out-stock"> Sale Off </span>
                            <h2 class="title-detail">@Model.Product.Name</h2>
                            <div class="clearfix product-price-cover">
                                <div class="product-price primary-color float-left">
                                    <span class="current-price text-brand">@priceDiscount.ToString("N0", new
                                                                                CultureInfo("vi-VN"))đ</span>
                                    <span>
                                        <span class="save-price font-md color3 ml-15">@Model.Product.Discount% Off</span>
                                        <span class="old-price font-md ml-15">@Model.Product.Price.ToString("N0", new
                                                                                        CultureInfo("vi-VN"))đ</span>
                                    </span>
                                </div>
                            </div>
                            <div class="detail-extralink mb-20">
                                <div class="detail-qty border radius">
                                    <a href="#" class="qty-down qty-down-detail" data-product-id="@Model.Product.ProductId"><i class="fi-rs-angle-small-down"></i></a>
                                    <input type="text" name="quantity" class="qty-val qty-val-detail" value="1" min="1" data-product-id="@Model.Product.ProductId">
                                    <a href="#" class="qty-up qty-up-detail" data-product-id="@Model.Product.ProductId"><i class="fi-rs-angle-small-up"></i></a>
                                </div>
                                <div class="product-extra-link2">
                                    <button type="submit" class="button button-add-to-cart-detail" data-product-id="@Model.Product.ProductId">
                                        <i class="fi-rs-shopping-cart"></i>Add to cart</button>
                                    @{
                                        var wishListClass = Model.IsInWishlist ? "active" : "";
                                        var wishListLabel = Model.IsInWishlist ? "Remove from Wishlist" : "Add To Wishlist";
                                    }
                                    <a aria-label="@wishListLabel" class="action-btn hover-up wishlist-toggle-btn @wishListClass"
                                       href="#" data-product-id="@Model.Product.ProductId"><i class="fi-rs-heart"></i></a>
                                </div>
                            </div>
                            <div class="font-xl">
                                <ul class="mr-50 float-start">
                                    <li class="mb-5">Category: <span class="text-brand">@Model.Product.Category</span></li>
                                    <li class="mb-5">Brand:<span class="text-brand"> @Model.Product.Brand</span></li>
                                    <li>Ogirin: <span class="text-brand">@Model.Product.Origin</span></li>
                                </ul>
                                <ul class="float-start">
                                    <li class="mb-5">Discount: <a href="#">@Model.Product.Discount</a></li>
                                    <li>Stock:<span class="in-stock text-brand ml-5">@Model.Product.Quantity Items In
                                            Stock</span></li>
                                </ul>
                            </div>
                        </div>
                        <!-- Detail Info -->
                    </div>
                </div>
                <div class="product-info">
                    <div class="tab-style3">
                        <ul class="nav nav-tabs text-uppercase">
                            <li class="nav-item">
                                <a class="nav-link active" id="Description-tab" data-bs-toggle="tab"
                                    href="#Description">Description</a>
                            </li>
                        </ul>
                        <div class="tab-content shop_info_tab entry-main-content">
                            <div class="tab-pane fade show active" id="Description">
                                <div class="">
                                    @Html.Raw(Model.Product.Description)
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
</div>
<section class="banners mb-25">
    <div class="container">
        <div class="section-title style-2 wow animate__animated animate__fadeIn mt-30" style="align-items:center;justify-content:center;">
            <h3>@sectionTitleEvent</h3>
        </div>

        <div class="row">
            @if (Model.Top3OpenEvents != null && Model.Top3OpenEvents.Any())
            {
                int i = 0;
                foreach (var eventItem in Model.Top3OpenEvents)
                {
                    var delay = i == 0 ? "0" : i == 1 ? ".2s" : ".4s";
                    var images = eventItem.ImageUrl?.Split('&') ?? new string[0];
                    var defaultImage = images.ElementAtOrDefault(0) ?? "/imgs/products/default.jpg";

                    <div class="col-lg-4 col-md-6">
                        <div class="banner-img wow animate__animated animate__fadeInUp mb-3" data-wow-delay="@delay">
                            <a asp-controller="Event" asp-action="GetEventById" asp-route-eventId="@eventItem.CleanEventId">
                                <img src="@defaultImage" alt="@eventItem.Title" class="img-fluid rounded"
                                     style="width: 100%; height: 400px; object-fit: cover;" />
                            </a>
                            <div class="mt-3 text-center">
                                <h5 class="mb-1 text-dark">@eventItem.Title</h5>
                                <p class="text-muted small mb-1">
                                    <i class="fi-rs-map-pin"></i> @eventItem.Address
                                </p>
                                <p class="text-muted small mb-1">
                                    <i class="fi-rs-calendar"></i> @eventItem.StartDate?.ToString("dd/MM/yyyy")
                                </p>

                                @if (!isFallback)
                                {
                                    <a asp-controller="Event" asp-action="GetEventById" asp-route-eventId="@eventItem.CleanEventId"
                                       class="btn btn-sm btn-success text-white mt-1">
                                        Tham gia
                                    </a>
                                }
                            </div>
                        </div>
                    </div>
                    i++;
                }
            }
            else
            {
                <div class="col-12 text-center">
                    <p class="text-muted">Không có sự kiện nào để hiển thị.</p>
                </div>
            }
        </div>
    </div>
</section>

<section class="product-tabs section-padding position-relative">
    <div class="container">
        <div class="section-title style-2 wow animate__animated animate__fadeIn mt-30" style="align-items:center;justify-content:center;">
            <h3>Sản phẩm bán chạy</h3>
        </div>
        <div class="tab-content" id="myTabContent">
            <div class="tab-pane fade show active" id="tab-one" role="tabpanel" aria-labelledby="tab-one">
                <div class="row product-grid-4">
                    @foreach (var item in Model.BestSellingProducts)
                    {
                        <div class="col-lg-1-5 col-md-4 col-12 col-sm-6">
                            <div class="product-cart-wrap mb-30 wow animate__animated animate__fadeIn" data-wow-delay=".1s">
                                <div class="product-img-action-wrap">
                                    <div class="product-img product-img-zoom">
                                        <a href="/Product/Detail/@item.ProductId">
                                            @{
                                                List<string> images = item.ImageUrl.Split('&').ToList();
                                            }
                                            <img class="default-img" src="@images[0]" alt="" />
                                            <img class="hover-img" src="@images[1]" alt="" />
                                        </a>
                                    </div>
                                    <div class="product-action-1">
                                        <a aria-label="Add To Wishlist" class="action-btn add-to-wishlist-btn" href="#" data-product-id="@item.ProductId">
                                            <i class="fi-rs-heart"></i>
                                        </a>
                                        <a aria-label="Add To Cart" class="action-btn add-to-cart-btn" href="#" data-product-id="@item.ProductId">
                                            <i class="fi-rs-shopping-cart"></i>
                                        </a>
                                        <a aria-label="Quick view" class="action-btn" href="/Product/Detail/@item.ProductId">
                                            <i class=" fi-rs-eye"></i>
                                        </a>
                                    </div>
                                    <div class="product-badges product-badges-position product-badges-mrg">
                                        <span class="hot">Hot</span>
                                    </div>
                                </div>
                                <div class="product-content-wrap">
                                    <div class="product-category">
                                        <a href="shop-grid-right.html">@item.Category</a>
                                    </div>
                                    <h2><a href="/Product/Detail/@item.ProductId">@item.Name</a></h2>
                                    <div>
                                        <span class="font-small text-muted">
                                            By <a href="vendor-details-1.html">@item.Brand</a>
                                        </span>
                                    </div>
                                    <div class="product-card-bottom">
                                        @{
                                            int priceProduct = (int)item.Price;
                                            int priceDiscountProduct = price - (item.Discount.HasValue ? (price * item.Discount.Value /
                                            100) : 0);
                                        }
                                        <div class="product-price">
                                            <span>@priceDiscountProduct.ToString("N0", new CultureInfo("vi-VN"))đ</span>
                                            <span class="old-price">@item.Price.ToString("N0", new CultureInfo("vi-VN"))đ</span>
                                        </div>
                                        <div class="add-cart">
                                            <a class="add add-to-cart-btn" href="#" data-product-id="@item.ProductId">
                                                <i class="fi-rs-shopping-cart mr-5"></i>Add
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</section>