@model TrashEventDTO

@{
    ViewData["Title"] = "Cập nhật điểm rác thải";
}

<div class="page-header breadcrumb-wrap">
    <div class="container">
        <div class="breadcrumb">
            <a href="/" rel="nofollow"><i class="fi-rs-home mr-5"></i>Trang chủ</a>
            <span></span> Cập nhật điểm rác
        </div>
    </div>
</div>

<div class="container mb-80 mt-50">
    <div class="row">
        <div class="col-lg-8 mb-40">
            <h1 class="heading-2 mb-10">Cập nhật điểm rác thải</h1>
            <div class="d-flex justify-content-between">
                <h6 class="text-body">Bạn có thể kéo ghim để thay đổi vị trí chính xác của điểm rác.</h6>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-6">
            <div class="row">
                <h4 class="mb-30">Thông tin chi tiết</h4>
                <form asp-action="UpdateTrashEvent" asp-controller="TrashEvent" method="post" enctype="multipart/form-data">
                    <input type="hidden" asp-for="TrashReportId" />
                    <input type="hidden" asp-for="Status" />
                    <input type="hidden" asp-for="CreatedAt" />

                    <div class="row">
                        <div class="mb-10">
                            <h6>Tọa độ</h6>
                        </div>
                        <div class="form-group col-lg-12">
                            <input type="text" id="locationInput" readonly asp-for="Location"
                                   class="form-control" placeholder="Tọa độ sẽ hiện ở đây...">
                            <button class="btn btn-success w-100 mt-2" type="button" onclick="getLocation()">
                                <i class="bi bi-cursor-fill"></i> Lấy vị trí hiện tại
                            </button>
                        </div>
                    </div>

                    <div class="row mt-3">
                        <div class="mb-10">
                            <h6>Địa chỉ</h6>
                        </div>
                        <div class="form-group col-lg-12">
                            <input type="text" asp-for="Address" class="form-control" placeholder="Địa chỉ cụ thể">
                        </div>
                    </div>

                    <div class="row mt-3">
                        <div class="mb-10">
                            <h6>Hình ảnh mới (tùy chọn)</h6>
                        </div>
                        <div class="form-group col-lg-12">
                            <input type="file" name="images" multiple class="form-control" style="height:auto;padding-left:5px;" />
                            <span class="text-danger">@Html.ValidationMessage("Images")</span>
                            <input type="hidden" asp-for="ImageUrl"/>
                        </div>
                    </div>

                    <div class="form-group mb-5 mt-3">
                        <div class="mb-10">
                            <h6>Mô tả</h6>
                        </div>
                        <textarea rows="5" asp-for="Description" class="form-control" placeholder="Mô tả chi tiết..."></textarea>
                    </div>

                    <div class="payment ml-30">
                        <button type="submit" class="btn btn-fill-out btn-block mt-20 float-end">
                            Cập nhật<i class="fi-rs-refresh ml-15"></i>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <div class="col-lg-6">
            <h4 class="mb-30"><i class="bi bi-geo-alt-fill"></i> Chỉnh vị trí trên bản đồ</h4>

            <div class="btn-group w-100 mb-2" role="group">
                <button type="button" class="btn btn-primary" id="btnMap" onclick="showTab('map')">
                    <i class="bi bi-map-fill"></i> Bản đồ
                </button>
                <button type="button" class="btn btn-outline-secondary" id="btnStreet" onclick="showTab('street')">
                    <i class="bi bi-signpost-split-fill"></i> Chế độ xem phố
                </button>
            </div>

            <div id="mapContainer" style="height: 550px;" class="border rounded mb-2"></div>
            <div id="streetContainer" style="height: 550px; display:none;" class="border rounded mb-2"></div>

            <div id="locationStatus" class="alert alert-info" role="alert">
                Bạn có thể di chuyển ghim để thay đổi vị trí chính xác.
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCiGqAY3IagwecyXc4-etRoWJHzV7LyfFU&libraries=places"></script>
    <script src="~/js/map/map.js"></script>
    <script>
        $(document).ready(function () {
            const initialLocation = "@Model.Location";

            if (initialLocation && initialLocation.includes(",")) {
                const parts = initialLocation.split(",");
                const lat = parseFloat(parts[0]);
                const lng = parseFloat(parts[1]);

                if (!isNaN(lat) && !isNaN(lng)) {
                    setInitialLocation(lat, lng);
                } else {
                    setLocationStatus("❌ Tọa độ không hợp lệ", "danger");
                }
            }
        });
    </script>
}
