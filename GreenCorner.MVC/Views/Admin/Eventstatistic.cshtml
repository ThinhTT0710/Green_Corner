@model EventAnalyticViewModel
@{
	ViewData["Title"] = "Thống kê sự kiện";
	Layout = "_LayoutAdmin";
}﻿
<section class="content-main">
    <div class="content-header">
        <div>
            <h2 class="content-title card-title">Thống kê sự kiện</h2>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-3">
            <div class="card card-body mb-4">
                <article class="icontext">
                    <span class="icon icon-sm rounded-circle bg-primary-light"><i class="text-primary material-icons md-event"></i></span>
                    <div class="text">
                        <h6 class="mb-1 card-title">Tổng sự kiện</h6>
                        <span>@Model.TotalEvent</span>
                        <span class="text-sm">Tổng số sự kiện đang điễn ra và đã hoàn thành</span>
                    </div>
                </article>
            </div>
        </div>
        <div class="col-lg-3">
            <div class="card card-body mb-4">
                <article class="icontext">
                    <span class="icon icon-sm rounded-circle bg-primary-light"><i class="text-success material-icons md-event_available"></i></span>
                    <div class="text">
                        <h6 class="mb-1 card-title">Sự kiện đang diễn ra</h6>
                        <span>@Model.TotalOpenEvent</span>
                        <span class="text-sm">Tổng số sự kiên đã hoàn thành</span>
                    </div>
                </article>
            </div>
        </div>
        <div class="col-lg-3">
            <div class="card card-body mb-4">
                <article class="icontext">
                    <span class="icon icon-sm rounded-circle bg-primary-light"><i class="text-success material-icons md-group"></i></span>
                    <div class="text">
                        <h6 class="mb-1 card-title">Tổng tình nguyện viên</h6>
                        <span>@Model.TotalVolunteer</span>
                        <span class="text-sm">Tổng số tình nguyện viên đã tham gia sự kiện.</span>
                    </div>
                </article>
            </div>
        </div>
        <div class="col-lg-3">
            <div class="card card-body mb-4">
                <article class="icontext">
                    <span class="icon icon-sm rounded-circle bg-primary-light"><i class="text-success material-icons md-person"></i></span>
                    <div class="text">
                        <h6 class="mb-1 card-title">TNV chờ duyệt</h6>
                        <span>@Model.TotalPedingVolunteer</span>
                        <span class="text-sm">Tình nguyện viên chờ phê duyệt.</span>
                    </div>
                </article>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-xl-8 col-lg-12">
            <div class="card mb-4">
                <article class="card-body">
                    <h5 class="card-title">Thống kê sự kiện</h5>
                    <canvas id="myChart" height="120"></canvas>
                </article>
            </div>
        </div>
        <div class="col-xl-4 col-lg-12">
            <div class="card mb-4">
                <article class="card-body">
                    <h5 class="card-title text-center">Sự kiện đang diễn ra</h5>
                    <div class="new-member-list">
                        @if (!Model.EventOpenList.Any())
                        {
                            <p class="text-center">Không có sự kiện nào đang diễn ra</p>
                        }
                        else
                        {
                            @foreach (var item in Model.TrashEventList)
                            {
                                <div class="d-flex align-items-center justify-content-between mb-4">
                                    <div class="d-flex align-items-center">
                                        @{
                                            var imageUrl = item.ImageUrl;
                                            var trashEventImg = imageUrl?.Contains("&") == true ? imageUrl.Split('&')[0] : imageUrl;
                                        }
                                        <img src="@trashEventImg" alt="" class="avatar" />
                                        <div>
                                            <h6 class="product-title">@item.Address</h6>
                                        </div>
                                    </div>
                                    <div>
                                        <h6>@item.Status</h6>
                                    </div>
                                </div>
                            }
                        }
                    </div>
                </article>
            </div>
        </div>
    </div>
    <div class="row">
            <div class="card mb-4">
                <header class="card-header">
                    <h4 class="card-title">Sự kiện đang diễn ra</h4>
                </header>
                <div class="card-body">
                    <div class="table-responsive">
                        <div class="table-responsive">
                            <table class="table align-middle table-nowrap mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th class="align-middle" scope="col">ID</th>
                                        <th class="align-middle" scope="col">Tên</th>
                                    <th class="align-middle" scope="col">Số lượng</th>
                                    <th class="align-middle" scope="col">Ngày bắt đầu</th>
                                        <th class="align-middle" scope="col">Ngày kết thúc</th>
                                        <th class="align-middle" scope="col">Địa chỉ</th>
                                        <th class="align-middle" scope="col">Trạng thái</th>
                                        <th class="align-middle" scope="col">Điểm thưởng</th>
                                    </tr>
                                </thead>
                                <tbody>
                                @foreach (var item in Model.EventOpenList)
                                    {
                                    <tr>
                                        <td>
                                            <a href="#" class="fw-bold">@item.CleanEventId</a></td>
                                        <td width="25%">
                                            <a href="#" class="itemside">
                                                <div class="left">
                                                    <img src="@item.ImageUrl" class="img-sm img-avatar" alt="Userpic" />
                                                </div>
                                                <div class="info pl-3">
                                                    <h6 class="mb-0 title">@item.Title</h6>
                                                </div>
                                            </a>
                                        </td>
                                        <td>@item.MaxParticipants người</td>
                                        <td>@item.StartDate?.ToString("HH:mm dd/MM/yyyy")</td>
                                        <td>@item.EndDate?.ToString("HH:mm dd/MM/yyyy")</td>
                                        <td>@item.Address</td>
                                        @if(item.Status == "Open"){
                                        <td>
                                            <span class="badge badge-pill badge-soft-warning">Đang diễn ra</span>
                                        </td>
                                        }
                                        <td>@item.PointsAward</td>
                                    </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <!-- table-responsive end// -->
                </div>
            </div>
    </div>
</section>
@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        (function ($) {
            "use strict";

            var chartData = @Html.Raw(Json.Serialize(Model.ChartData));

            if ($('#myChart').length) {
                var ctx = document.getElementById('myChart').getContext('2d');
                var chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['Tháng 1', 'Tháng 2', 'Tháng 3', 'Tháng 4', 'Tháng 5', 'Tháng 6', 'Tháng 7', 'Tháng 8', 'Tháng 9', 'Tháng 10', 'Tháng 11', 'Tháng 12'],
                        datasets: [
                            {
                                label: 'Sự kiện đã hoàn thành',
                                tension: 0.3,
                                fill: true,
                                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                                borderColor: 'rgba(75, 192, 192, 1)',
                                data: chartData.completedEvents
                            },
                            {
                                label: 'Báo cáo rác đã hoàn thành',
                                tension: 0.3,
                                fill: true,
                                backgroundColor: 'rgba(54, 162, 235, 0.2)',
                                borderColor: 'rgba(54, 162, 235, 1)',
                                data: chartData.completedTrashReports
                            },
                            {
                                label: 'Báo cáo rác chờ xác nhận',
                                tension: 0.3,
                                fill: true,
                                backgroundColor: 'rgba(255, 206, 86, 0.2)',
                                borderColor: 'rgba(255, 206, 86, 1)',
                                data: chartData.pendingTrashReports
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    usePointStyle: true,
                                }
                            }
                        }
                    }
                });
            }
        })(jQuery);
    </script>
}
